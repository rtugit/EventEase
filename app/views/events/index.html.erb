<div class="home-page" data-controller="sort-events">
  <!-- Renders search input form with autocomplete -->
  <section class="search-section">
    <div class="search-card">
      <%= form_with url: events_path, method: :get, class: "search-form", local: true do |f| %>
        <div class="search-field">
          <label for="search_title">Title</label>
          <div class="search-input-wrapper">
            <%= text_field_tag :title, params[:title],
                placeholder: "Search events...",
                id: "search_title",
                autocomplete: "off",
                data: { search_type: "title" } %>
            <div class="search-dropdown" id="title-dropdown"></div>
          </div>
        </div>

        <div class="search-field">
          <label for="search_location">Location</label>
          <div class="search-input-wrapper">
            <%= text_field_tag :location, params[:location],
                placeholder: "City or venue",
                id: "search_location",
                autocomplete: "off",
                data: { search_type: "location" } %>
            <div class="search-dropdown" id="location-dropdown"></div>
          </div>
        </div>

        <div class="search-field">
          <label for="search_date">Date</label>
          <%= date_field_tag :date, params[:date], id: "search_date", required: false %>
        </div>

        <div class="search-action">
          <button type="submit" class="search-btn">Search</button>
        </div>
      <% end %>
    </div>
  </section>

  <!-- Displays event category chips -->
  <section class="categories-section" data-controller="category-dropdown">
    <!-- Hamburger button for mobile/tablet -->
    <button type="button"
            class="category-dropdown-toggle"
            data-category-dropdown-target="button"
            data-action="click->category-dropdown#toggle"
            aria-label="Toggle category menu">
      <span class="dropdown-toggle-text">
        <% if params[:category].present? %>
          <%= params[:category] %>
        <% elsif params[:filter] == 'my_events' %>
          My Events
        <% else %>
          All Categories
        <% end %>
      </span>
      <svg class="dropdown-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M6 9l6 6 6-6"/>
      </svg>
    </button>

    <!-- Dropdown menu for mobile/tablet -->
    <div class="category-dropdown-menu" data-category-dropdown-target="menu">
      <%= link_to events_path,
          class: "category-dropdown-item #{'active' unless params[:category] || params[:filter] == 'my_events'}",
          data: { action: "click->category-dropdown#close" } do %>
        <span>All</span>
      <% end %>

      <%= link_to events_path(filter: 'my_events'),
          class: "category-dropdown-item #{'active' if params[:filter] == 'my_events'}",
          data: { action: "click->category-dropdown#close" } do %>
        <span>My Events</span>
      <% end %>

      <% Event::CATEGORIES.each do |category| %>
        <%= link_to events_path(category: category),
            class: "category-dropdown-item #{'active' if params[:category] == category}",
            data: { action: "click->category-dropdown#close" } do %>
          <span><%= category %></span>
        <% end %>
      <% end %>
    </div>

    <!-- Horizontal scroll for desktop -->
    <div class="categories-scroll">
      <%= link_to events_path, class: "category-chip #{'active' unless params[:category] || params[:filter] == 'my_events'}" do %>
        <span>All</span>
      <% end %>

      <%= link_to events_path(filter: 'my_events'), class: "category-chip #{'active' if params[:filter] == 'my_events'}" do %>
        <span>My Events</span>
      <% end %>

      <% Event::CATEGORIES.each do |category| %>
        <%= link_to events_path(category: category), class: "category-chip #{'active' if params[:category] == category}" do %>
          <span><%= category %></span>
        <% end %>
      <% end %>
    </div>
  </section>

  <% if params[:filter] == 'my_events' %>
    <!-- Shows My Upcoming Events -->
    <section class="events-section">
      <div class="section-header">
        <h3 class="section-title">My Upcoming Events</h3>
      </div>

      <% if @my_upcoming_events.present? %>
        <div class="events-grid">
          <% @my_upcoming_events.each do |event| %>
            <%= render "event_card", event: event %>
          <% end %>
        </div>
      <% else %>
        <p class="no-events-message">No upcoming events at the moment.</p>
      <% end %>
    </section>

    <!-- Shows My Events with Sort -->
    <section class="events-section">
      <div class="section-header">
        <h3 class="section-title">My Events</h3>

        <div class="sort-dropdown">
          <select id="sort-events" class="sort-select">
            <option value="popular" <%= 'selected' if params[:sort].blank? || params[:sort] == 'popular' %>>Most Popular</option>
            <option value="title_asc" <%= 'selected' if params[:sort] == 'title_asc' %>>Title (A-Z)</option>
            <option value="title_desc" <%= 'selected' if params[:sort] == 'title_desc' %>>Title (Z-A)</option>
            <option value="date_asc" <%= 'selected' if params[:sort] == 'date_asc' %>>Date (Oldest)</option>
            <option value="date_desc" <%= 'selected' if params[:sort] == 'date_desc' %>>Date (Latest)</option>
            <option value="location_asc" <%= 'selected' if params[:sort] == 'location_asc' %>>Location (A-Z)</option>
            <option value="location_desc" <%= 'selected' if params[:sort] == 'location_desc' %>>Location (Z-A)</option>
          </select>
        </div>
      </div>

      <% if @events.present? %>
        <div class="events-grid">
          <% @events.each do |event| %>
            <%= render "event_card", event: event %>
          <% end %>
        </div>
      <% else %>
        <p class="no-events-message">You haven't created or registered for any events yet.</p>
      <% end %>
    </section>

    <!-- Shows My Past Events -->
    <section class="events-section">
      <div class="section-header">
        <h3 class="section-title">My Past Events</h3>
      </div>

      <% if @my_past_events.present? %>
        <div class="events-grid">
          <% @my_past_events.each do |event| %>
            <%= render "event_card", event: event %>
          <% end %>
        </div>
      <% else %>
        <p class="no-events-message">No past events.</p>
      <% end %>
    </section>
  <% else %>
    <!-- Shows Upcoming Events -->
    <section class="events-section">
      <div class="section-header">
        <h3 class="section-title">Upcoming Events</h3>
      </div>

      <% if @upcoming_events.present? %>
        <div class="events-grid">
          <% @upcoming_events.each do |event| %>
            <%= render "event_card", event: event %>
          <% end %>
        </div>
      <% else %>
        <p class="no-events-message">No upcoming events at the moment.</p>
      <% end %>
    </section>

    <!-- Shows All Events with Sort -->
    <section class="events-section">
      <div class="section-header">
        <h3 class="section-title">
          <% if params[:category].present? %>
            <%= params[:category] %> Events
          <% else %>
            All Events
          <% end %>
        </h3>

        <div class="sort-dropdown">
          <select id="sort-events" class="sort-select">
            <option value="popular" <%= 'selected' if params[:sort].blank? || params[:sort] == 'popular' %>>Most Popular</option>
            <option value="title_asc" <%= 'selected' if params[:sort] == 'title_asc' %>>Title (A-Z)</option>
            <option value="title_desc" <%= 'selected' if params[:sort] == 'title_desc' %>>Title (Z-A)</option>
            <option value="date_asc" <%= 'selected' if params[:sort] == 'date_asc' %>>Date (Oldest)</option>
            <option value="date_desc" <%= 'selected' if params[:sort] == 'date_desc' %>>Date (Latest)</option>
            <option value="location_asc" <%= 'selected' if params[:sort] == 'location_asc' %>>Location (A-Z)</option>
            <option value="location_desc" <%= 'selected' if params[:sort] == 'location_desc' %>>Location (Z-A)</option>
          </select>
        </div>
      </div>

      <% if @popular_events.present? %>
        <div class="events-grid">
          <% @popular_events.each do |event| %>
            <%= render "event_card", event: event %>
          <% end %>
        </div>
      <% else %>
        <p class="no-events-message">No events at the moment.</p>
      <% end %>
    </section>
  <% end %>

  <!-- Displays bottom navigation bar -->
  <nav class="bottom-nav">
    <%= link_to events_path, class: "nav-item" do %>
      <span>Home</span>
    <% end %>

    <%= link_to events_path, class: "nav-item" do %>
      <span>Explore</span>
    <% end %>

    <%= link_to new_event_path, class: "nav-item nav-item-add" do %>
      <i class="fa-solid fa-plus"></i>
    <% end %>

    <%= link_to events_path, class: "nav-item" do %>
      <span>Events</span>
    <% end %>

    <% if current_user %>
      <%= link_to edit_user_registration_path, class: "nav-item" do %>
        <span>Profile</span>
      <% end %>
    <% else %>
      <%= link_to new_user_session_path, class: "nav-item" do %>
        <span>Login</span>
      <% end %>
    <% end %>
  </nav>
</div>
