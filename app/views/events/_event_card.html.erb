<% require 'zlib' %>
<%= link_to event_path(event), class: "event-card" do %>
  <div class="event-card-image">
    <% if event.photos.attached? %>
      <%= responsive_image(event, :photos) %>
    <% else %>
      <div class="placeholder-image">
        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
          <line x1="16" y1="2" x2="16" y2="6"/>
          <line x1="8" y1="2" x2="8" y2="6"/>
          <line x1="3" y1="10" x2="21" y2="10"/>
        </svg>
      </div>
    <% end %>
  </div>

  <div class="event-card-body">
    <h3 class="event-title"><%= event.title %></h3>

    <% if event.starts_at.present? %>
      <p class="event-date">
        <%= event.starts_at.strftime("%d.%m.%Y Â· %H:%M") %>
      </p>
    <% end %>

    <% if event.location.present? %>
      <p class="event-location">
        <i class="fa-solid fa-location-dot"></i>
        <%= event.location %>
      </p>
    <% end %>
  </div>

  <div class="avatars-guest">
    <% avatars = %w[/images/avatars/girl.png /images/avatars/girll.png /images/avatars/man.png /images/avatars/mann.png] %>
    <% registrations = event.registrations.limit(4).to_a %>
    <% registrations.each_with_index do |registration, index| %>
      <% email = registration.email.to_s %>
      <% hash_index = Zlib.crc32(email) % avatars.size rescue 0 %>
      <% avatar_file = avatars[hash_index] %>
      <% handle = email.split("@").first %>
      <% initial = handle[0].to_s.upcase.presence || "?" %>

      <% if avatar_file.present? %>
        <div class="avatar-guest" title="<%= registration.name.presence || email %>">
          <img src="<%= asset_path(avatar_file) %>" alt="<%= registration.name.presence || email %>">
        </div>
      <% else %>
        <div class="avatar-guest" title="<%= registration.name.presence || email %>"><%= initial %></div>
      <% end %>
    <% end %>

    <% if event.registrations.count > registrations.size %>
      <div class="avatar-guest avatar-more" title="<%= event.registrations.count - registrations.size %> more">
        +<%= event.registrations.count - registrations.size %>
      </div>
    <% end %>
  </div>
<% end %>
