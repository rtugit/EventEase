<% require 'zlib' %>
<%= link_to event_path(event), class: "event-card" do %>
  <div class="event-card-image">
    <% if event.photos.attached? %>
      <%= responsive_image(event, :photos) %>
    <% else %>
      <div class="placeholder-image">
        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
          <line x1="16" y1="2" x2="16" y2="6"/>
          <line x1="8" y1="2" x2="8" y2="6"/>
          <line x1="3" y1="10" x2="21" y2="10"/>
        </svg>
      </div>
    <% end %>
  </div>

  <div class="event-card-body">
    <% if event.category.present? %>
      <span class="event-card-category-badge"><%= event.category %></span>
    <% end %>
    <h3 class="event-title"><%= event.title %></h3>

    <% if event.starts_at.present? %>
      <p class="event-date">
        <%= event.starts_at.strftime("%d.%m.%Y Â· %H:%M") %>
      </p>
    <% end %>

    <% if event.location.present? %>
      <p class="event-location">
        <i class="fa-solid fa-location-dot"></i>
        <%= event.location %>
      </p>
    <% end %>

    <% if event.organizer.present? %>
      <div class="organizer-info" style="display: flex; align-items: center; gap: 8px; margin-top: 12px; margin-bottom: 8px;">
        <%= render_avatar(event.organizer, size: 24) %>
        <span class="organizer-name" style="font-size: 13px; color: #5b6b6a;">Hosted by <%= event.organizer.first_name %></span>
      </div>
    <% end %>

    <div class="avatars-guest">
      <% registrations = event.registrations.limit(4).to_a %>

      <% registrations.each do |registration| %>
        <div class="avatar-guest" title="<%= registration.name.presence || registration.email %>">
          <%= render_avatar(registration, size: 24) %>
        </div>
      <% end %>

      <% if event.registrations.count > registrations.size %>
        <div class="avatar-guest avatar-more" title="<%= event.registrations.count - registrations.size %> more">
          +<%= event.registrations.count - registrations.size %>
        </div>
      <% end %>
    </div>
  </div>
<% end %>
