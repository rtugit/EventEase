# EventEase Work Log — December 12, 2025

## Git Operations

1. **Fetch & Rebase** (`a0a6e17`): Pulled colleagues' latest changes, rebased `last-minute` branch onto `origin/last-minute`
2. **Event Show Avatars** (`272a47d`): Event show avatar logic parity with cards + CSS support
3. **New Event Section** (`a9f3721`): Home render New Event section using card grid to match Popular
4. **Cloudinary Fix** (`3a7d4b1`): Remove direct cl_image_tag on event show; use responsive_image only
5. **Create Event Button** (`67be3c0`): UI style Create Event as button using search-btn on dashboard/index
6. **Dark Mode Fix** (`488c3b2`): Fix dark mode to prevent black body background on form pages

**Branch**: `edited-css` (pushed to origin with all 6 commits)

---

## Feature Implementations

### 1. Attendee Avatars (Event Show Page)

- **File**: `app/views/events/show.html.erb` (lines 106–130)
- **What**: Unified attendee avatars with event card logic
  - If user has photo → render via `responsive_image(user, :photo)`
  - Else → deterministic placeholder from `/images/avatars/{girl.png,girll.png,man.png,mann.png}` using `Zlib.crc32(email) % 4`
  - Fallback: first letter if needed
- **CSS**: `app/assets/stylesheets/pages/_event_show.scss` (lines 289–327)
  - Added `overflow: hidden`, `.avatar-image/img` sizing with `object-fit: cover`
  - Preserved 32px circles, overlapping with `-8px` margin, 2px borders
- **Impact**: Event show now matches event card avatar system; consistent user experience across all avatar displays

### 2. New Event Section Layout

- **File**: `app/views/events/index.html.erb` (lines 111–125)
- **What**: Replaced table-based layout with card grid
  - Before: HTML table with title, location, date, link columns
  - After: `<div class="events-grid">` + `render "event_card"` for each event
- **Impact**: Homepage index now shows both "Popular Event" and "New Event" in the same responsive grid layout, improving visual consistency

### 3. Cloudinary Configuration Error

- **File**: `app/views/events/show.html.erb` (lines 54–60)
- **What**: Removed unconditional `cl_image_tag` call that was failing in development
  - Kept: `responsive_image(@event, :photos, ...)` which detects `ENV['CLOUDINARY_URL']`
  - Removed: Direct `cl_image_tag @event.photos.first.key, ...` (requires Cloudinary config)
- **Error Fixed**: "Must supply cloud_name in tag or in configuration"
- **Impact**: Event show page no longer crashes in local development; gracefully falls back to ActiveStorage

### 4. Create Event Button Styling

- **File**: `app/views/events/index.html.erb` (line 115)
- **What**: Changed "Create Event" link to button style
  - Applied class `search-btn` (defined in `pages/_home.scss` lines 172–197)
  - Style: `$button-color` background, white text, 14px padding, 12px border-radius, hover/active animations
- **Impact**: Dashboard "Create Event" now renders as a filled button matching search button appearance for visual consistency

### 5. Dark Mode Background Fix

- **File**: `app/assets/stylesheets/components/_mobile_first.scss` (lines 279–293)
- **What**: Prevented black body background in dark mode media query
  - Changed `body { background-color: #121212; }` → `body { background-color: $background; color: $primary-font; }`
  - Adjusted cards: `#1e1e1e` → `lighten($light-gray, 2%)`
- **Impact**: Pages like `/users/edit` and `/events/new` no longer appear completely black in dark mode; form pages remain usable and readable

---

## Key Code Patterns Used

| Pattern                                         | Location                                | Purpose                                                |
| ----------------------------------------------- | --------------------------------------- | ------------------------------------------------------ |
| Hash-based avatar selection                     | `_event_card.html.erb`, `show.html.erb` | Deterministic random avatar assignment per email       |
| `responsive_image` helper                       | Multiple views                          | Environment-aware Cloudinary/ActiveStorage rendering   |
| `.search-btn` class                             | `_home.scss`, applied to links/buttons  | Consistent button styling across pages                 |
| `$background`, `$button-color`, `$primary-font` | Config imports                          | Centralized color system for consistency               |
| `@media (prefers-color-scheme: dark)`           | `_mobile_first.scss`                    | Optional dark mode support without breaking form pages |

---

## Files Modified

1. **app/views/events/show.html.erb**

   - Attendee avatars with photo detection + hash-based fallback (lines 106–130)
   - Removed Cloudinary error-prone `cl_image_tag` (lines 54–60)

2. **app/views/events/index.html.erb**

   - New Event section: replaced table with responsive grid (lines 111–125)
   - Create Event: styled as button with `search-btn` class (line 115)

3. **app/assets/stylesheets/pages/\_event_show.scss**

   - Avatar CSS support: `overflow: hidden`, image sizing, `object-fit: cover` (lines 289–327)

4. **app/assets/stylesheets/components/\_mobile_first.scss**
   - Dark mode: fixed black background on body, kept component-level tweaks (lines 279–293)

---

## Seed Data Included

**File**: `db/seeds.rb`

- **Users**: 7 total

  - 5 Organizers with varied profiles
  - Demo user (demo@example.com)
  - Duck Duck Go user (duck@duckduckgo.com)
  - 50%+ users assigned placeholder avatars

- **Events**: 19 total

  - All with detailed descriptions (250–600 characters)
  - Random photos from `/images/photo-1.jpg`, `photo-2.jpg`, `photo-3.jpg`
  - Includes "Regular Friday Pub" event (December 12, 2025, 21:00–01:00)
  - Timezone: Europe/Berlin

- **Registrations**: 182 total
  - Varied attendee counts per event
  - Mix of registered and checked-in statuses

**Load Command**: `bin/rails db:seed`

---

## Current Branch Status

- **Branch**: `edited-css` (created from `last-minute`)
- **Commits**: 6 new (a0a6e17...488c3b2)
- **Remote**: Pushed to `origin/edited-css`
- **PR**: https://github.com/rtugit/EventEase/pull/new/edited-css

---

## Team Handoff Checklist

✅ Pull `edited-css` branch  
✅ Run `bin/rails db:seed` to load fake data  
✅ Test avatar display on event cards and event show page  
✅ Verify dark mode doesn't break form pages  
✅ Check "Create Event" button styling on dashboard  
✅ Confirm "Popular Event" and "New Event" grid layouts match

---

## Notes for Future Sessions

- **Avatar System**: Deterministic hash ensures consistency; email → same avatar across refreshes
- **Image Paths**: Public images in `/images/avatars/` bypass asset pipeline; use `/images/` prefix directly
- **Responsive Image Helper**: Handles both `has_one` and `has_many` attachments; checks `ENV['CLOUDINARY_URL']` for production
- **Dark Mode**: Only applies to preferable systems; does not force dark UI on all users
- **Seed Data**: Safe to re-run; migrations handle duplicates and updates gracefully
